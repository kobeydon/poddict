{% extends "pdblog/base.html" %}

{% block contents %}

  <div class="post">
      <h1>{{ article_detail.title }}</h1>
      <p class='like-btn' data-href='{{ article_detail.get_api_like_url }}'>
      <span class="liked_cnt">{{ article_detail.likes.count }}</span>
      like</P>
      <div>&nbsp;{{ article_detail.pub_date }}</div>
      <p class="text">{{ article_detail.text|linebreaksbr }}</p>
  </div>

  {% if request.user.is_authenticated %}
  <div><a href="{% url 'pdblog:article_update' article_detail.pk %}">edit this article</a></div>
  <div><a href="{% url 'pdblog:article_delete' article_detail.pk %}">delete this article</a></div>
  {% endif %}
  
	<script>
		(function(){
			const this_ = $(".like-btn");
			const likeUrl = tthis_attr("data-href");
			$.ajax({
				url: likeUrl,
				method: "GET", 
				data: {"status":0},
				success: function(data){
					if (data.liked){
						this_addClass("on");
					}
				}, error: function(error){
					console.log("error")
				}
			})
		});
		$(".like-btn").click(function(e){
			e.preventDefault()
			const this_ = $(this);
			const like_cnt = $(".liked_cnt");
			const likeUrl = this_.attr("data-href");
			if (likeUrl){
				$.ajax({
					url: likeUrl,
					method: "GET",
					data: {"status":1},
					success: function(data){
						let change_like = like_cnt.text();
						if (data.liked){
							like_cnt.text(++change_like);
							this_.addClass("on");
						} else { 
							like_cnt.text(--change_like);
							this_.removeClass("on");
						}
					}, error: function(error){
						console.log("error")
					}
				})
			}
		})
	</script>
{% endblock contents %}
